---
title: Dashboards
template: page.hbt
---

Tutorial: Creating your own PiLR Dashboard
============

Interested in writing a custom dashboard for your PiLR study? We have
created a simple template package for you to get started. This
tutorial covers all the steps, from getting a copy of the template to
seeing your dashboard live on PiLR.

A Dashboard in 7 Steps
----------------------

Custom dashboard functions can be created in R and hosted as a package
on GitHub. When you update your code, your PiLR dashboard
automatically updates, too. You can easily generate a wide variety of
dashboard graphics, from simple barcharts to detailed geographical
maps.

1. Fork the pilrdash-template repo
(https://github.com/pilrhealth/pilrdash-template.git) into your Github
account. If you don't have a GitHub account, you can create one
now. It's free!

2. Rename the forked repository. Choose a name without any dashes or
underscores. We are creating an R package and those characters are not
allowed in R package names.  For the purposes of this tutorial, let's
say you renamed it *dashtest*.

3. Clone the forked repo. Now you'll have a local copy of the 
*dashtest* repo in your Github account. 

4. Each dashboard graphic is generated by an R function. R functions
live in R packages, and R packages need a name!  We can name an R
package by editing the DESCRIPTION file. Recall we have to name our
package the *same thing* as the repo name, in this case, *dashtest*.
   
6. I imported the dash-definition.json file successfully into
PiLR. Add the dashboard through the Store Catalog.
   
7. I'm constructing a test function in *scratch*, getting reasonable
errors as I'm filling in required parameters. Now, I'm getting:
Please put your PiLR API consumer key in R/pilrsecret.txt, even
though it's in there? Do I have to reload the package?


Panel Function Argument List
-------------

All custom functions must include these three arguments:  
`data` the dataframe read in from a PiLR project  
`params` a list of all above arguments sent to pilr_dashboard_panel  
`...` a generic that allows any other argument to be passed through  
You may wish to update documentation for your function. If so, you can
use the roxygen2 package,
as well as manually editing the DESCRIPTION file in the template.


pilr_dashboard_panel Argument List
------------------------------

Each of these arguments can be passed into the pilr_dashboard_panel function:  
`package_function` Function to be applied to the dataset  
`package_url` URL pointing to the package on GitHub  
`data` List of arguments for finding the dataset (data_set, schema, project, pilr_api_server)  
`return_type` Type to be returned from the function (r:vega, r:image, or r:html)  
`filter_params` List of parameters for choosing subsets of a dataset (participant, group, date)  
`dashboard_params` Dashboard parameters(?)  

Access Code
-----------

When testing your function locally, pilr_dashboard_panel needs to read
in your PiLR API consumer key from a secure file. Create a text file
named "pilrsecret.txt" under the folder "R" in your function's
package. Paste your access code in this file, followed by a blank
line.  Our template provides a .gitignore file which causes
"pilrsecret.txt" to not be committed to a repo.

Return Types
------------

Currently only [Vega](http://trifacta.github.io/vega/) return types
are supported. A common package for generating Vega visuals in R is
[ggvis](http://ggvis.rstudio.com/).

Webhooks
--------

In order to allow OpenCPU to update your package each time you push
changes to GitHub, you will need to setup a webhook. To do so, go to
your package on GitHub and click on Settings->Webhooks & Services on
the sidebar. To read more about OpenCPU and webhooks, see the bottom
of [this page](https://www.opencpu.org/api.html).

Importing Dashboard Definition
------------------------------

To import your custom dashboard function into PiLR, you will need to
update the parameters in the provided "dash-definition.json" document.

Private Repo?
-------------

If you wish for your GitHub repo to be private, you will need to add
the Github user "pilrhealth" (without quotes) as a collaborator. This
will allow PiLR to see and use your package.
